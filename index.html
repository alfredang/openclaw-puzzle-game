<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OpenClaw Puzzle Game</title>
<style>
  :root {
    --bg: #0f0f1a;
    --surface: #1a1a2e;
    --surface2: #16213e;
    --accent: #e94560;
    --accent2: #0f3460;
    --text: #eee;
    --text-dim: #888;
    --tile-radius: 12px;
    --gap: 4px;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 20px;
    overflow: hidden;
  }

  h1 {
    font-size: 2rem;
    margin-bottom: 4px;
    background: linear-gradient(135deg, var(--accent), #ff6b6b);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .subtitle {
    color: var(--text-dim);
    font-size: 0.85rem;
    margin-bottom: 20px;
  }

  .controls {
    display: flex;
    gap: 12px;
    margin-bottom: 16px;
    flex-wrap: wrap;
    justify-content: center;
  }

  .controls button, .controls select {
    padding: 8px 18px;
    border: none;
    border-radius: 8px;
    background: var(--surface2);
    color: var(--text);
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.2s;
    outline: none;
  }

  .controls button:hover { background: var(--accent); transform: translateY(-1px); }
  .controls select { appearance: none; padding-right: 28px; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%23eee' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10z'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 10px center; }
  .controls select:focus { border: 1px solid var(--accent); }

  .stats {
    display: flex;
    gap: 24px;
    margin-bottom: 16px;
    font-size: 1rem;
  }

  .stats span { color: var(--text-dim); }
  .stats strong { color: var(--text); }

  .board-container {
    position: relative;
  }

  .board {
    display: grid;
    gap: var(--gap);
    padding: var(--gap);
    background: var(--surface);
    border-radius: 16px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.05);
    user-select: none;
    -webkit-user-select: none;
    touch-action: manipulation;
  }

  .tile {
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: var(--tile-radius);
    font-weight: 700;
    cursor: pointer;
    transition: transform 0.15s ease, box-shadow 0.15s ease;
    position: relative;
    background: linear-gradient(145deg, var(--surface2), #1a1a3e);
    box-shadow: 0 2px 8px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.08);
  }

  .tile:not(.empty):hover {
    transform: scale(1.04);
    box-shadow: 0 4px 16px rgba(233,69,96,0.3), inset 0 1px 0 rgba(255,255,255,0.1);
  }

  .tile:not(.empty):active { transform: scale(0.97); }

  .tile.empty {
    background: transparent;
    box-shadow: none;
    cursor: default;
  }

  .tile.correct {
    background: linear-gradient(145deg, #1a3a2e, #16213e);
    box-shadow: 0 2px 8px rgba(0,255,100,0.15), inset 0 1px 0 rgba(255,255,255,0.08);
  }

  /* Win overlay */
  .win-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.8);
    display: none;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    z-index: 100;
    animation: fadeIn 0.3s;
  }

  .win-overlay.show { display: flex; }

  .win-overlay h2 {
    font-size: 3rem;
    margin-bottom: 8px;
    animation: bounceIn 0.5s;
  }

  .win-overlay p { color: var(--text-dim); margin-bottom: 20px; font-size: 1.1rem; }

  .win-overlay button {
    padding: 12px 32px;
    border: none;
    border-radius: 10px;
    background: var(--accent);
    color: white;
    font-size: 1rem;
    cursor: pointer;
    transition: transform 0.2s;
  }

  .win-overlay button:hover { transform: scale(1.05); }

  /* Confetti */
  .confetti {
    position: fixed;
    width: 10px;
    height: 10px;
    border-radius: 2px;
    z-index: 101;
    animation: confettiFall 3s ease-out forwards;
  }

  @keyframes fadeIn { from { opacity: 0 } to { opacity: 1 } }
  @keyframes bounceIn { 0% { transform: scale(0.3); opacity: 0 } 50% { transform: scale(1.1) } 100% { transform: scale(1); opacity: 1 } }
  @keyframes confettiFall {
    0% { transform: translateY(0) rotate(0deg); opacity: 1; }
    100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
  }

  @media (max-width: 480px) {
    h1 { font-size: 1.5rem; }
    .stats { gap: 16px; font-size: 0.9rem; }
  }
</style>
</head>
<body>

<h1>ðŸ§© OpenClaw Puzzle</h1>
<p class="subtitle">Slide the tiles to solve the puzzle</p>

<div class="controls">
  <select id="difficulty">
    <option value="3">3Ã—3 Easy</option>
    <option value="4" selected>4Ã—4 Classic</option>
    <option value="5">5Ã—5 Hard</option>
  </select>
  <button onclick="shuffle()">ðŸ”€ Shuffle</button>
  <button onclick="resetGame()">ðŸ”„ Reset</button>
</div>

<div class="stats">
  <div><span>Moves:</span> <strong id="moves">0</strong></div>
  <div><span>Time:</span> <strong id="timer">0:00</strong></div>
  <div><span>Best:</span> <strong id="best">â€”</strong></div>
</div>

<div class="board-container">
  <div class="board" id="board"></div>
</div>

<div class="win-overlay" id="winOverlay">
  <h2>ðŸŽ‰ You Win!</h2>
  <p id="winMsg">Solved in 0 moves and 0:00</p>
  <button onclick="closeWin()">Play Again</button>
</div>

<script>
let size = 4;
let tiles = [];
let emptyIdx;
let moves = 0;
let seconds = 0;
let timerInterval = null;
let started = false;
let bestTimes = JSON.parse(localStorage.getItem('puzzleBest') || '{}');

const board = document.getElementById('board');
const movesEl = document.getElementById('moves');
const timerEl = document.getElementById('timer');
const bestEl = document.getElementById('best');
const diffSelect = document.getElementById('difficulty');
const winOverlay = document.getElementById('winOverlay');
const winMsg = document.getElementById('winMsg');

function init() {
  size = parseInt(diffSelect.value);
  const total = size * size;
  tiles = Array.from({ length: total - 1 }, (_, i) => i + 1);
  tiles.push(0);
  emptyIdx = total - 1;
  moves = 0;
  seconds = 0;
  started = false;
  clearInterval(timerInterval);
  timerInterval = null;
  render();
  updateStats();
  updateBest();
}

function render() {
  const total = size * size;
  const tileSize = Math.min(Math.floor((Math.min(window.innerWidth, 500) - 40) / size), 90);
  board.style.gridTemplateColumns = `repeat(${size}, ${tileSize}px)`;
  board.style.gridTemplateRows = `repeat(${size}, ${tileSize}px)`;
  board.innerHTML = '';

  tiles.forEach((val, idx) => {
    const div = document.createElement('div');
    div.className = 'tile' + (val === 0 ? ' empty' : '') + (val === idx + 1 ? ' correct' : '');
    div.style.fontSize = tileSize > 50 ? '1.4rem' : '1rem';
    if (val !== 0) {
      div.textContent = val;
      div.addEventListener('click', () => moveTile(idx));
    }
    board.appendChild(div);
  });
}

function moveTile(idx) {
  const neighbors = getNeighbors(idx);
  if (!neighbors.includes(emptyIdx)) return;

  if (!started) {
    started = true;
    timerInterval = setInterval(() => { seconds++; updateStats(); }, 1000);
  }

  tiles[emptyIdx] = tiles[idx];
  tiles[idx] = 0;
  emptyIdx = idx;
  moves++;
  render();
  updateStats();

  if (checkWin()) {
    clearInterval(timerInterval);
    setTimeout(() => showWin(), 300);
  }
}

function getNeighbors(idx) {
  const row = Math.floor(idx / size), col = idx % size;
  const n = [];
  if (row > 0) n.push(idx - size);
  if (row < size - 1) n.push(idx + size);
  if (col > 0) n.push(idx - 1);
  if (col < size - 1) n.push(idx + 1);
  return n;
}

function checkWin() {
  const total = size * size;
  for (let i = 0; i < total - 1; i++) {
    if (tiles[i] !== i + 1) return false;
  }
  return true;
}

function shuffle() {
  init();
  // Perform random valid moves to ensure solvability
  const numMoves = size * size * 40;
  for (let i = 0; i < numMoves; i++) {
    const neighbors = getNeighbors(emptyIdx);
    const pick = neighbors[Math.floor(Math.random() * neighbors.length)];
    tiles[emptyIdx] = tiles[pick];
    tiles[pick] = 0;
    emptyIdx = pick;
  }
  render();
}

function resetGame() { init(); }

function updateStats() {
  movesEl.textContent = moves;
  const m = Math.floor(seconds / 60);
  const s = seconds % 60;
  timerEl.textContent = `${m}:${s.toString().padStart(2, '0')}`;
}

function updateBest() {
  const key = `${size}x${size}`;
  bestEl.textContent = bestTimes[key] ? `${bestTimes[key]}s` : 'â€”';
}

function showWin() {
  const key = `${size}x${size}`;
  if (!bestTimes[key] || seconds < bestTimes[key]) {
    bestTimes[key] = seconds;
    localStorage.setItem('puzzleBest', JSON.stringify(bestTimes));
    updateBest();
  }
  const m = Math.floor(seconds / 60);
  const s = seconds % 60;
  winMsg.textContent = `Solved in ${moves} moves and ${m}:${s.toString().padStart(2, '0')}`;
  winOverlay.classList.add('show');
  spawnConfetti();
}

function closeWin() {
  winOverlay.classList.remove('show');
  shuffle();
}

function spawnConfetti() {
  const colors = ['#e94560', '#ff6b6b', '#ffd93d', '#6bcb77', '#4d96ff', '#ff6b9d'];
  for (let i = 0; i < 80; i++) {
    const c = document.createElement('div');
    c.className = 'confetti';
    c.style.left = Math.random() * 100 + 'vw';
    c.style.top = -10 + 'px';
    c.style.background = colors[Math.floor(Math.random() * colors.length)];
    c.style.animationDelay = Math.random() * 2 + 's';
    c.style.animationDuration = (2 + Math.random() * 2) + 's';
    c.style.width = (6 + Math.random() * 8) + 'px';
    c.style.height = (6 + Math.random() * 8) + 'px';
    document.body.appendChild(c);
    setTimeout(() => c.remove(), 5000);
  }
}

diffSelect.addEventListener('change', shuffle);
window.addEventListener('resize', render);

shuffle();
</script>
</body>
</html>
